version: "3.3"

services:
  db:
    build:
      context: "./backend"
      dockerfile: "db.dockerfile"
    env_file:
      - ".env.dev"
    # Ports are only open for dev
    ports:
    - "5435:5432"
    networks:
      - "tuskynet"
    volumes:
      - "tusky:/var/lib/postgresql/data"

  backend:
    build:
      context: ./backend
      dockerfile: backend.dockerfile
#    environment:
#      - SERVER_NAME=${DOMAIN}
#      - SERVER_HOST=https://${DOMAIN}
#      - SMTP_HOST=${SMTP_HOST}
    env_file:
      - ".env.dev"
    volumes:
    - "./backend/:/src"
    networks:
      - "tuskynet"
    links:
      - "db:db"
    depends_on:
      - "db"
    command: "./_wait_for_it.sh -q db:5432 -- python manage.py runserver"

#  web:
#    build:
#      context: "./"
#      dockerfile: "scripts/backend.dockerfile"
#      args:
#        # Todo: Figure out how to use arguments
#        INSTALL_DEV: ${INSTALL_DEV-true}
##    environment:
##      - SERVER_NAME=${DOMAIN}
##      - SERVER_HOST=https://${DOMAIN}
##      - SMTP_HOST=${SMTP_HOST}
#    env_file:
#      - ".env.dev"
#    volumes:
#    - "./:/src"
#    networks:
#      - "tuskynet"
#    links:
#      - "db:db"
#    ports:
#    - "8000:8000"
#    depends_on:
#      - "db"

volumes:
  tusky:

networks:
  tuskynet:
    driver: "bridge"
