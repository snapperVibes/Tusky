version: "3.3"

services:
  db:
    build:
      context: "./"
      dockerfile: "scripts/Dockerfile.db"
    env_file:
      - ".env.dev"
    # Ports are only open for dev
    ports:
    - "5435:5432"
    networks:
      - "tuskynet"
    volumes:
      - "tusky:/var/lib/postgresql/data"

  web:

    build:
      context: "./"
      dockerfile: "scripts/Dockerfile.web"
      args:
        # Todo: Figure out how to use arguments
        INSTALL_DEV: ${INSTALL_DEV-true}
#    environment:
#      - SERVER_NAME=${DOMAIN}
#      - SERVER_HOST=https://${DOMAIN}
#      - SMTP_HOST=${SMTP_HOST}
    env_file:
      - ".env.dev"
    environment:
      # Adding /src to PYTHONPATH _tests_pre_start.py to access app
      # If PYTHONPATH existed, we'd just append to the path like "PYTHONPATH=${PYTHONPATH}:/src"
      - "PYTHONPATH=/src"
    volumes:
    - "./:/src"
    networks:
      - "tuskynet"
    links:
      - "db:db"
    ports:
    - "8000:8000"
    depends_on:
      - "db"

volumes:
  tusky:

networks:
  tuskynet:
    driver: "bridge"
